<div class="card">
  <h2>Payment</h2>
  <p class="muted">
    Key ID: <code><%= DummyGateway.key_id %></code><br>
    Provider Order ID: <code><%= @provider_order_id %></code><br>
    Delivery city: <%= @order.delivery_city %><br>
    Payment status: <strong><%= @order.payment_status %></strong>
  </p>

  <% total_paise = @order.total_paise %>
  <p>
    Amount: <strong><%= format("₹%.2f", total_paise / 100.0) %></strong>
  </p>

  <% wallet = current_user.wallet %>
  <% wallet_balance = wallet&.balance_paise.to_i %>
  <p class="muted">
    Wallet balance: <strong><%= format("₹%.2f", wallet_balance / 100.0) %></strong>
  </p>

  <div class="row">
    <form method="post" action="<%= wallet_payments_path(order_id: @order.id) %>">
      <%= hidden_field_tag :authenticity_token, form_authenticity_token %>
      <button type="submit" class="secondary" <%= "disabled" if wallet_balance < total_paise %>>
        Pay with wallet
      </button>
    </form>

    <a href="<%= gateway_checkout_path(order_id: @order.id) %>">Proceed to checkout</a>

    <a class="muted" href="<%= wallet_path %>">Recharge wallet</a>
    <a class="muted" href="<%= order_path(@order) %>">Back to order</a>
  </div>
</div>


